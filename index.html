<html>
<head>
    <!--导入jquery-->
    <script type="text/javascript" src='source/lib/jquery-3.1.1.js'></script>
    <!--导入bootstrap的css-->
    <link rel="stylesheet" href="./source/lib/bootstrap-4.6.1/css/bootstrap.css"/>
    <!--导入bootstrap的js-->
    <script type="text/javascript" src="./source/lib/bootstrap-4.6.1/js/bootstrap.js"></script>
    <link rel="stylesheet" type="text/css" href="./source/static/css/index.css">
    <!--导入ztree的css-->
    <link rel="stylesheet" type="text/css" href="source/lib/ztree.-3.5/css/zTreeStyle/zTreeStyle.css">
    <!--导入ztree的js-->
    <script type="text/javascript" src="source/lib/ztree.-3.5/js/jquery.ztree.all-3.5.js"></script>
    <title>BLOG_LINGWH</title>
    <script>
        $(function () {
            // var config = {
            //     navbar1: {
            //         item_home: {
            //             name: 'Home',
            //             href: 'index.html',
            //             type: 'href',
            //             collapseId: 'collapse_item_home'
            //         },
            //         item_java: {
            //             name: 'JAVA',
            //             collapseId: 'collapse_item_java',
            //             type: 'href',
            //             navbar2: {
            //                 item_java_spring: {
            //                     name: 'Spring',
            //                     href: '#',
            //                     bookList: [
            //                         {
            //                             name: '1.Spring-1',
            //                             content_data_path: 'https://raw.githubusercontent.com/lingwh1995/blog/gh-pages/notes/mysql.html',
            //                             nav_data_path: 'https://raw.githubusercontent.com/lingwh1995/blog/gh-pages/source/db/mysql.json'
            //                         },
            //                         {
            //                             name: '2.Spring-2',
            //                             href: '#'
            //                         },
            //                     ]
            //                 },
            //                 item_java_springcloud: {
            //                     name: 'SpringCloud',
            //                     href: '#',
            //                 },
            //                 item_java_springboot: {
            //                     name: 'SpringBoot',
            //                     href: '#',
            //                 }
            //             }
            //         },
            //         item_database: {
            //             name: '数据库',
            //             collapseId: 'collapse_item_database',
            //             type: 'href',
            //             navbar2: {
            //                 item_database_mysql: {
            //                     name: 'Mysql',
            //                     href: '#',
            //                     content_data_path: 'https://raw.githubusercontent.com/lingwh1995/blog/gh-pages/notes/mysql.html',
            //                     nav_data_path: 'https://raw.githubusercontent.com/lingwh1995/blog/gh-pages/source/db/mysql.json'
            //                 },
            //                 item_database_oracel: {
            //                     name: 'Oracle',
            //                     href: '#',
            //                     content_data_path: 'https://raw.githubusercontent.com/lingwh1995/blog/gh-pages/notes/oracle.html',
            //                     nav_data_path: 'https://raw.githubusercontent.com/lingwh1995/blog/gh-pages/source/db/oracle.json'
            //                 }
            //             }
            //         },
            //         item_tools: {
            //             name: '工具支持',
            //             collapseId: 'collapse_item_tools',
            //             type: 'href',
            //             navbar2: {
            //                 item_tools_idea: {
            //                     name: 'idea',
            //                     href: '#',
            //                 },
            //                 item_tool_eclipse: {
            //                     name: 'eclipse',
            //                     href: '#',
            //                 }
            //             }
            //         },
            //         item_toggle_booklist: {
            //             name: '隐藏书籍目录',
            //             collapseId: 'item_toggle_booklist',
            //             type: 'button',
            //             style: 'margin-left:50px'
            //         }
            //     }
            // };
            // console.log(JSON.stringify(config));
            let config;
            $.ajax({
                async: false,
                url: 'https://raw.githubusercontent.com/lingwh1995/blog/gh-pages/source/conf/conf.json',
                type: 'get',
                dataType: 'json',
                success: function (result) {
                    config = result;
                }
            });

            renderNavbar();

            /**
             * 渲染一级、二级...导航栏样式
             */
            function renderNavbar() {
                const navbar1 = config.navbar1;
                for (const key_navbar1 in navbar1) {
                    console.log();
                    let li = '';
                    if(navbar1[key_navbar1].type == 'href') {
                        li = `<li class="nav-item">
                                    <a class="nav-link ${key_navbar1}" data-toggle="collapse" href="#${navbar1[key_navbar1].collapseId}">
                                        ${navbar1[key_navbar1].name}
                                    </a>
                                 </li>`;
                    }
                    if(navbar1[key_navbar1].type == 'button') {
                        li = `<li class="nav-item">
                                   <button id="toggle-book-list" type="button" style="${navbar1[key_navbar1].style}" class="btn btn-dark">${navbar1[key_navbar1].name}</button>
                                 </li>`;
                    }
                    $(".header .navbar-first-level ul").append(li);
                    const navbar2 = navbar1[key_navbar1].navbar2;
                    if (navbar2 !== undefined) {
                        let navbar2lis = '';
                         for(const key_navbar2 in navbar2) {
                            navbar2lis += `<li className="nav-item">
                                         <a class="nav-link" navLevel1Id="${key_navbar1}" navLevel2Id="${key_navbar2}" nav_data_path="${navbar2[key_navbar2].nav_data_path}" content_data_path="${navbar2[key_navbar2].content_data_path}" href="${navbar2[key_navbar2].href}">${navbar2[key_navbar2].name}</a>
                                       </li>`;
                        }
                        let collapse =
                            `<div class="collapse" id="${navbar1[key_navbar1].collapseId}">
                                        <div class="card card-body">
                                            <nav class="navbar navbar-expand-md navbar-dark bg-primary">
                                                <div class="collapse navbar-collapse">
                                                    <ul class="navbar-nav mr-auto">
                                                       ${navbar2lis}
                                                    </ul>
                                                </div>
                                            </nav>
                                        </div>
                                    </div>`;
                        $('.header .collapse-div').append(collapse);
                    }
                }
            }

            /**
             * 给一级添加初始点击事件
             */
            $('.header .navbar-first-level ul li a').click(function () {
                const collapseId = $(this).attr('href');
                $(collapseId).siblings().removeClass('show');
                if(!$(collapseId).hasClass('show')){
                    $('.container-fluid .jumbotron').show();
                    $('.container-fluid .body').hide();
                }
                if(collapseId.toLowerCase().indexOf('home') != -1){
                    hiedeSecondLevelBar();
                }
                //添加active效果
                var $firstLevelLinks = $('.header .navbar-first-level ul li a');
                for(let i=0; i<$firstLevelLinks.length; i++){
                    if($($firstLevelLinks[i]).attr('href') != collapseId){
                        $($firstLevelLinks[i]).removeClass('active');
                    }
                }

                $(this).addClass('active');
                $(this).siblings().removeClass('active');
                //隐藏 展开/隐藏书籍目录 按钮
                $('#toggle-book-list').hide();
            });

            $('#blog').click(function (){
                hiedeSecondLevelBar();
            });
            $('.container-fluid .body').click(function (){
                hiedeSecondLevelBar();
            });
            /**
             * 隐藏二级导航
             */
            function hiedeSecondLevelBar(){
                const collapseArr = $('.header .collapse-div').children();
                for(let i=0; i<collapseArr.length; i++ ){
                    $(collapseArr[i]).removeClass('show');
                }
            }
            //给homePageButton添加超链接
            //$homePageButton.attr('href',config.navbar.first_level.item_home.href);

            //记录上一个点击的锚点的
            let prevClickanchorPoint = '1dot';
            /**
             * 二级导航条点击事件
             */
            $('.header .collapse-div div ul li a').click(function () {
                //添加active效果
                var $secondLevelLinks = $('.header .collapse-div div ul li a');
                for(let i=0; i<$secondLevelLinks.length; i++){
                    if($($secondLevelLinks[i]).attr('navlevel1id') == $(this).attr('navlevel1id')){
                        if($($secondLevelLinks[i]).attr('navlevel2id') != $(this).attr('navlevel2id')){
                            $($secondLevelLinks[i]).removeClass('active');
                        }else{
                            $($secondLevelLinks[i]).addClass('active');
                        }
                    }
                }
                $('.container-fluid .jumbotron').hide();
                $('.container-fluid .body').show();
                const content_data_path = $(this).attr('content_data_path');
                //$("#txt-right").load(content_data_path);
                const nav_data_path = $(this).attr('nav_data_path');
                //renderZtree(nav_data_path);
                const setting = {
                    callback: {
                        onClick: zTreeOnClickBooKList
                    },
                    view: {
                        showIcon: false,
                    }
                };
                const navLevel1Id = $(this).attr('navLevel1Id');
                const navLevel2Id = $(this).attr('navLevel2Id');
                const navBar2s = config.navbar1[navLevel1Id].navbar2;
                const children = [];
                for(const key in navBar2s){
                    //console.log(navBar2s[key].bookList);
                    children.push({name:navBar2s[key].name,children:navBar2s[key].bookList});
                }
                var zNodes = [
                    {name: $(this).text(), navLevel1Id:navLevel1Id,
                        navLevel2Id:navLevel2Id,children: children}
                ];
                $.fn.zTree.init($("#ztree-left-booklist"), setting, zNodes);
                //显示 展开/隐藏书籍目录 按钮
                $('#toggle-book-list').show();
            });

            /**
             * 渲染ztreee
             * @param nav_data_path
             */
            function renderZtree(nav_data_path) {
                const setting = {
                    callback: {
                        onClick: zTreeOnClickBook
                    },
                    view: {
                        showIcon: false,
                    }
                };

                $.ajax({
                    async: false,
                    url: nav_data_path,
                    type: 'GET',
                    dataType: 'json',
                    success: function (result) {
                        const zNodes = result;
                        $.fn.zTree.init($("#ztree-left"), setting, zNodes);
                    }
                })
            }

            /**
             * ztree单击事件
             * @param event
             * @param treeId
             * @param treeNode
             * @param clickFlag
             */
            function zTreeOnClickBook(event, treeId, treeNode, clickFlag){
                //点击之前首先清除上一个锚点的背景色
                $('#'+prevClickanchorPoint).css('background','#F3F3F3')
                const anchorPoint =treeNode.navMenuItemId;
                //锚点跳跃
                location.hash = anchorPoint;
                //给关键字设置背景色
                $('#'+anchorPoint).css('background','yellow')
                prevClickanchorPoint = anchorPoint;
            }
            /**
             * ztree单击事件
             * @param event
             * @param treeId
             * @param treeNode
             * @param clickFlag
             */
            function zTreeOnClickBooKList(event, treeId, treeNode, clickFlag){
                const setting = {
                    callback: {
                        onClick: zTreeOnClickBook
                    },
                    view: {
                        showIcon: false,
                    }
                };

                $.ajax({
                    async: false,
                    url: treeNode.nav_data_path,
                    type: 'GET',
                    dataType: 'json',
                    success: function (result) {
                        const zNodes = result;
                        $.fn.zTree.init($("#ztree-left-book"), setting, zNodes);
                    }
                })
                $("#txt-right").load(treeNode.content_data_path);
                treeNode.isHidden = true;
            }
            $('.container-fluid .body').hide();

            /**
             * 点击展开或者隐藏书籍目录
             */
            $('#toggle-book-list').click(function (){
                $('#ztree-left-booklist-col').toggle();
                if($('#ztree-left-booklist-col').attr('style') != ''){
                    $('#ztree-left-book-col').removeClass('col-2').addClass('col-3');
                    $('#toggle-book-list').text('显示书籍目录');
                }else{
                    $('#ztree-left-book-col').removeClass('col-3').addClass('col-2');
                    $('#toggle-book-list').text('隐藏书籍目录');
                }
            });

            //显示 展开/隐藏书籍目录 按钮
            $('#toggle-book-list').hide();
        });
    </script>

</head>
<body>
    <div class="container-fluid">
        <div class="header">
            <div class="navbar navbar-expand-lg navbar-dark bg-primary navbar-first-level">
                <a class="navbar-brand" id="blog" href="#">BLOG</a>
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav mr-auto"></ul>
                    <form class="form-inline my-2 my-lg-0">
                        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                    </form>
                </div>
            </div>
            <div class="collapse-div">
            </div>
        </div>
        <div class="h10"></div>
        <div class="body">
            <div class="row">
                <div class="col-1" id="ztree-left-booklist-col">
                    <div id="ztree-left-booklist" class="ztree" style="background: #DDDDDD;"></div>
                </div>
                <div class="col-2" id="ztree-left-book-col">
                    <div id="ztree-left-book" class="ztree" style="background: #DDDDDD;"></div>
                </div>
                <div class="col-9">
                    <pre id="txt-right" style="border-left: 1px solid #DDDDDD;height: calc(85vh);"></pre>
                </div>
            </div>
        </div>
        <div class="jumbotron" style="height: 88%;margin-top: 10px;">
            <div style="text-align: center;height: 15%">
                <h1 class="display-4">Hello, Friend!</h1>
                <p class="lead">有朋自远方来,不亦乐乎！</p>
            </div>
            <hr class="my-4">
            <div style="height: 53%">
                <pre>
                        <h5>
                        Java简介：
                            1.Java是一门面向对象的编程语言，1996年1月，Sun公司发布了Java的第一个开发工具包。
                            2.Java不仅吸收了C++语言的各种优点，还摒弃了C++里难以理解的多继承、指针等概念，因此Java语言具有功能强大和简单易用两个特征。
                            3.Java作为静态面向对象编程语言的代表，极好地实现了面向对象理论，允许程序员以优雅的思维方式进行复杂的编程。
                            4.Java可以编写桌面应用程序、Web应用程序、分布式系统和嵌入式系统应用程序等。
                            5.Java是一种开源的语言，有强大的社区力量和广泛的开发人员支持，并且在此基础上建立了完善的生态系统。

                        示例代码:
                            public class Hello {
                                public static void main(String[] args) {
                                    System.out.println("Hello World!");
                                }
                            }
                        </h5>
                </pre>
            </div>
            <hr class="my-4">
            <div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="card" style="text-align: center">
                            <div class="card-body">
                                <h5 class="card-title">GITHUB</h5>
                                <p class="card-text">一个开源代码的自由世界</p>
                                <a class="btn btn-primary btn-lg" href="https://github.com/lingwh1995" target="_blank">传送门</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card" style="text-align: center">
                            <div class="card-body">
                                <h5 class="card-title">GITEE</h5>
                                <p class="card-text">一个开放源代码的自由世界（国内版）</p>
                                <a class="btn btn-info btn-lg" href="https://gitee.com/lingwh1995" target="_blank">传送门</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<html>